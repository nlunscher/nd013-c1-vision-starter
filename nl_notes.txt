
# Setup the data

sudo apt install docker.io

https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker
curl -s -L https://nvidia.github.io/nvidia-container-runtime/experimental/$distribution/nvidia-container-runtime.list | sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list
sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker

https://stackoverflow.com/questions/59691207/docker-build-with-nvidia-runtime

git clone git@github.com:nlunscher/nd013-c1-vision-starter.git
git checkout devel-nl

sudo docker build -t project-dev-tf230 -f Dockerfile.gpu .

sudo docker run -it --rm --name udacity_cv --shm-size=2g -v /media/nlunscher/AVIN_drive_3/Waymo:/app/project/  project-dev

sudo docker start udacity_cv
sudo docker attach udacity_cv

python download_process.py --data_dir /app/project/processed/ --temp_dir /app/project/raw/


# Run the project

sudo docker run -it --rm --gpus all --name udacity_cv_project -v /home/nlunscher/Documents/Learning/Udacity_Self_Driving_Car_Engineer/2_Computer_Vision/course_project:/app/project/ -p 8888:8888 -p 6006:6006 project-dev


sudo docker run -it --rm --gpus all --name udacity_cv_project -v /home/administrator/nl/learning/Udacity_Self_Driving_Car_Engineer/2_Computer_Vision/course_project:/app/project/ -p 8888:8888 project-dev-tf240

sudo docker start udacity_cv_project
sudo docker attach udacity_cv_project


# Running training

# new config

python edit_config.py \
--train_dir ../data/waymo_processed/train \
--eval_dir ../data/waymo_processed/test \
--batch_size 8 \
--checkpoint /home/workspace/training/pretrained-models/ssd_resnet50_v1_fpn_640x640_coco17_tpu-8/checkpoint/ckpt-0 \
--label_map label_map.pbtxt

# Training

python experiments/model_main_tf2.py --model_dir=training/reference2/ --pipeline_config_path=training/reference2/pipeline_new.config
python experiments/model_main_tf2.py --model_dir=training/improved2/ --pipeline_config_path=training/improved2/pipeline_new.config

# Eval
python experiments/model_main_tf2.py --model_dir=training/reference/ --pipeline_config_path=training/reference/pipeline_new.config --checkpoint_dir=training/reference/
python experiments/model_main_tf2.py --model_dir=training/improved4/ --pipeline_config_path=training/improved4/pipeline_new.config --checkpoint_dir=training/improved4/

python experiments/model_main_tf2.py --model_dir=training/reference/ --pipeline_config_path=training/reference/pipeline_new_test.config --checkpoint_dir=training/reference/


# Eport
python experiments/exporter_main_v2.py --input_type image_tensor --pipeline_config_path training/improved4/pipeline_new.config --trained_checkpoint_dir training/improved4 --output_directory training/improved4/exported_model/

# Video 
python inference_video.py --labelmap_path label_map.pbtxt --model_path training/improved4/exported_model/saved_model --tf_record_path ../data/waymo_processed/val/segment-11183906854663518829_2294_000_2314_000_with_camera_labels.tfrecord --config_path training/improved4/pipeline_new.config --output_path training/improved4/animation_segment-11183906854663518829_2294_000_2314_000_with_camera_labels.mp4

python inference_video.py --labelmap_path label_map.pbtxt --model_path training/improved4/exported_model/saved_model --tf_record_path ../data/waymo_processed/val/segment-11119453952284076633_1369_940_1389_940_with_camera_labels.tfrecord --config_path training/improved4/pipeline_new.config --output_path training/improved4/animation_segment-11119453952284076633_1369_940_1389_940_with_camera_labels.mp4

python inference_video.py --labelmap_path label_map.pbtxt --model_path training/improved4/exported_model/saved_model --tf_record_path ../data/waymo_processed/val/segment-11252086830380107152_1540_000_1560_000_with_camera_labels.tfrecord --config_path training/improved4/pipeline_new.config --output_path training/improved4/animation_segment-11252086830380107152_1540_000_1560_000_with_camera_labels.mp4





edit 
/usr/local/lib/python3.6/dist-packages/pycocotools/cocoeval.py", line 507





# Results
# Eval

Batch 2
Steps 1000



Batch 16
Steps 1000


Batch 8
Steps 25000



